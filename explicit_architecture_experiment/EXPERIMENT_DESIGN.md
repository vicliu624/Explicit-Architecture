# 显性架构实验设计文档

## 1. 研究背景与动机

### 1.1 问题定义
在软件工程中，代码的组织结构对开发效率和维护性有重要影响。**显性架构**指代码的物理结构（目录、文件命名）与语义结构（模块边界、功能分组）高度对齐的架构模式。而**非显性架构**则指物理结构与语义结构不对齐的情况。

### 1.2 研究假设
我们假设显性架构能够：
1. **降低函数间耦合度**：通过清晰的模块边界减少不必要的依赖
2. **提升AI模型性能**：使位置信号与语义边界对齐，便于模型学习
3. **增强可预测性**：使代码结构更容易被模型理解和生成

## 2. 实验设计

### 2.1 实验目标
验证显性架构相比非显性架构在以下方面的优势：
- 函数补全任务的准确率
- 跨文件引用预测的准确性
- 代码结构的耦合度指标
- 模型注意力模式的可解释性

### 2.2 实验变量

#### 自变量
- **架构类型**：显性架构 vs 非显性架构
- **代码内容**：保持完全一致（控制变量）

#### 因变量
- **性能指标**：Exact Match, CodeBLEU, AST相似度
- **耦合度指标**：fan_in, fan_out, import_in, import_out
- **机制指标**：注意力熵、位置嵌入相似度、线性探针准确率

### 2.3 实验控制
- **代码内容控制**：显性和非显性版本使用完全相同的代码内容
- **模型控制**：使用相同的预训练模型和训练参数
- **数据控制**：使用相同的数据集和划分方式

## 3. 数据构造方法

### 3.1 显性架构构造
```python
# 保持原有目录结构
domain/
├── payment/
│   ├── authorize/
│   │   └── AuthorizeCommand.py
│   └── process/
│       └── PaymentProcessor.py
└── user/
    └── management/
        └── UserManager.py
```

### 3.2 非显性架构构造
```python
# 打乱目录结构，随机命名
project/
├── f001.py  # 原 AuthorizeCommand.py
├── f002.py  # 原 PaymentProcessor.py
└── f003.py  # 原 UserManager.py
```

### 3.3 任务样本生成
1. **函数补全任务**：随机掩盖函数体，预测实现
2. **跨文件引用任务**：给定调用点，预测被调用函数
3. **耦合度分析**：计算每个函数的依赖关系

## 4. 评估方法

### 4.1 性能评估
- **Exact Match**：完全匹配的准确率
- **CodeBLEU**：考虑代码结构的BLEU分数
- **AST相似度**：抽象语法树的相似度

### 4.2 耦合度评估
- **fan_in**：被其他函数调用的次数
- **fan_out**：调用其他函数的次数
- **import_in**：被其他文件导入的次数
- **import_out**：导入其他文件的次数
- **coupling_score**：综合耦合度分数

### 4.3 机制分析
- **注意力分析**：计算注意力矩阵的熵和集中度
- **位置嵌入分析**：比较位置嵌入的相似性
- **线性探针**：训练分类器预测语义类型

## 5. 统计检验

### 5.1 假设检验
- **H1检验**：显性架构性能 > 非显性架构性能
- **H2检验**：显性架构的位置信号可预测性更高

### 5.2 统计方法
- **配对t检验**：比较显性和非显性架构的性能差异
- **Mann-Whitney U检验**：非参数检验
- **效应量计算**：Cohen's d
- **多重比较校正**：FDR控制

## 6. 实验流程

### 6.1 数据准备阶段
1. 收集源代码项目
2. 生成显性和非显性架构副本
3. 构造任务样本
4. 计算耦合度指标

### 6.2 模型训练阶段
1. 数据预处理和tokenization
2. 模型微调
3. 超参数调优
4. 多随机种子实验

### 6.3 评估分析阶段
1. 性能指标计算
2. 注意力模式分析
3. 线性探针训练
4. 统计检验

### 6.4 结果解释阶段
1. 结果可视化
2. 机制分析
3. 结论总结

## 7. 预期结果

### 7.1 性能结果
- 显性架构在函数补全任务上准确率提升5-15%
- 显性架构在跨文件引用预测上准确率提升10-20%

### 7.2 耦合度结果
- 显性架构的平均耦合度降低20-30%
- 显性架构的模块内耦合度更高，模块间耦合度更低

### 7.3 机制结果
- 显性架构的注意力熵更低（更集中）
- 显性架构的位置嵌入可预测性更高
- 线性探针在显性架构下分类准确率更高

## 8. 实验限制与改进

### 8.1 实验限制
- 数据集规模限制
- 模型规模限制
- 语言类型限制（主要针对Python/Java）

### 8.2 改进方向
- 扩展到更多编程语言
- 使用更大的预训练模型
- 增加更多类型的代码任务

## 9. 贡献与意义

### 9.1 理论贡献
- 验证了架构设计对AI模型性能的影响
- 提供了位置信号与语义对齐的理论基础

### 9.2 实践意义
- 为代码架构设计提供指导
- 为AI代码生成工具优化提供方向
- 为软件工程教育提供量化证据
